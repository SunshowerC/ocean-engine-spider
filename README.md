
# 概述
本项目用于爬取 巨量纵横 的直播数据汇总

# 如何启动？

1. 安装依赖包
  ```
  npm ci
  ```
2. 运行爬虫
  ```
  # 开发模式
  ACCOUNT=1300546909@qq.com PW=Ocean123 npm run start:dev

  # 构建后运行
  ACCOUNT=1300546909@qq.com PW=Ocean123 npm start 

  # 切换账号需要添加 NEW_ACC 环境变量，如
  # 注意，新账号的首次登录，可能需要验证码，后续的登录则不需要
  ACCOUNT=someNewAcc PW=somePassword NEW_ACC=1 npm start 
  
  ```
3. 控制台查看运行结果：
  ```
  当前直播数据汇总：
    平均观看次数：0,
    累计观看次数：0,
    在线数量：0,
    推广中的账号数量：0
  ```
  
# 构建
```
npm run build
```




# 设计思路


## 难点
1. 登录接口的 account/password 并非明文传输，而是通过加密后调用的登录接口
![](https://user-images.githubusercontent.com/13402013/221606443-7581a950-aaca-43c3-a6fe-2aab87dcedfe.png)

2. 登录接口并不一定可以直接调用成功，有时候需要滑块验证码。
![](https://user-images.githubusercontent.com/13402013/221605749-8a94eaa2-b9f7-45c9-91aa-11b11b275402.png)


## 方案

由于站点为了防止自动化程序和爬虫，登录存在滑块验证码限制。

所以绕过滑块验证码，有以下方案：

1. 破解滑块验证算法：滑块验证码的生成算法并不是绝对安全的，如果攻击者能够破解算法，就可以通过算法生成正确的滑块验证结果，从而绕过滑块验证码。

2. 分析前端代码：滑块验证码的前端代码通常会包含一些JS代码，攻击者可以通过分析这些代码，获取验证所需的参数，然后模拟滑块拖动操作，从而绕过滑块验证码。

3. 通过机器学习模型识别滑块位置：攻击者可以使用机器学习模型对滑块验证码进行分析，从而自动识别滑块位置，并模拟拖动操作。

4. 模拟真实用户，让滑块验证码机制不再出现。滑块验证码并非每次都会出现，而是在一些高风险操作，频繁请求等特殊场景才会需要滑块验证码，在技术层面上呈现为某些 cookie 是否存在。只要保证一部分的 cookie 存在，请求会被视为正常请求，不会出现滑块验证码。



基于技术能力和时间成本，本爬虫采用方案4，使通过 puppeteer 框架，模拟真实用户的输入点击，存储真实生成的 cookies，可绕过验证码机制。
- 优点：成本较低，技术比较成熟。
- 缺点：爬虫启动效率不高，消耗资源较多。








